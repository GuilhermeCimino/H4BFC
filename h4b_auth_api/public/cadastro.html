<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro - H4B F.C.</title>
    <style>
        body { font-family: Arial; max-width: 400px; margin: 50px auto; padding: 20px; }
        input { width: 100%; padding: 10px; margin: 10px 0; box-sizing: border-box; }
        button { padding: 10px; margin: 5px; }
        #status { padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h2>Cadastro de Funcion√°rios</h2>
    
    <div id="status"></div>
    
    <form id="cadastroForm">
        <input type="text" id="nome" placeholder="Nome completo" required>
        <input type="email" id="email" placeholder="Email corporativo" required>
        <button type="submit" style="background: #28a745; color: white; width: 100%;">
            Cadastrar Funcion√°rio
        </button>
    </form>
    
    <button onclick="logout()" style="background: #dc3545; color: white; width: 100%;">
        üö™ Sair do Sistema
    </button>
    
    <script>
    // 1. VERIFICA SE TEM TOKEN
    const token = localStorage.getItem('h4bfc_token');
    const statusDiv = document.getElementById('status');
    
    if (!token) {
        statusDiv.innerHTML = '<div style="background: #f8d7da; color: #721c24; padding: 10px;">‚ö†Ô∏è ACESSO NEGADO! Fa√ßa login primeiro.</div>';
        setTimeout(() => {
            window.location.href = '/login.html';
        }, 2000);
    } else {
        statusDiv.innerHTML = '<div style="background: #d4edda; color: #155724; padding: 10px;">‚úÖ VOC√ä EST√Å LOGADO! Pode cadastrar funcion√°rios.</div>';
    }
    
    // 2. CONFIGURA FORMUL√ÅRIO
    document.getElementById('cadastroForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        if (!token) {
            alert('Sess√£o expirada! Fa√ßa login novamente.');
            window.location.href = '/login.html';
            return;
        }
        
        const nome = document.getElementById('nome').value;
        const email = document.getElementById('email').value;
        
        const btn = document.querySelector('button[type="submit"]');
        const originalText = btn.textContent;
        btn.textContent = 'Cadastrando...';
        btn.disabled = true;
        
        try {
            const response = await fetch('/api/cadastro', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': token
                },
                body: JSON.stringify({ nome: nome, email: email })
            });
            
            const result = await response.text();
            
            if (response.ok) {
                const data = JSON.parse(result);
                alert('‚úÖ ' + data.message);
                document.getElementById('cadastroForm').reset();
                statusDiv.innerHTML = `<div style="background: #d4edda; color: #155724; padding: 10px;">
                    ‚úÖ √öLTIMO CADASTRO: ${nome} (${email})
                </div>`;
            } else {
                alert('‚ùå ERRO: ' + result);
                if (response.status === 401) {
                    localStorage.removeItem('h4bfc_token');
                    window.location.href = '/login.html';
                }
            }
        } catch (error) {
            alert('üîå ERRO DE CONEX√ÉO: ' + error.message);
        } finally {
            btn.textContent = originalText;
            btn.disabled = false;
        }
    });
    
    // 3. FUN√á√ÉO SAIR
    function logout() {
        if (confirm('Tem certeza que deseja sair?')) {
            localStorage.removeItem('h4bfc_token');
            window.location.href = '/login.html';
        }
    }
    
    // 4. MOSTRA TOKEN (APENAS DEBUG)
    console.log('Token atual:', token);
    </script>
</body>
</html>
